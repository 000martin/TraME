#! /bin/sh
## TraME config script

NLOPT_INCLUDE_PATH="-I${R_HOME}/include -I${R_HOME}/library/Rcpp/include -I${R_HOME}/library/RcppArmadillo/include -I/usr/local/include"
NLOPT_LIB_PATH="-I/usr/local/lib"
NLOPT_LIBS="-lnlopt"

if [[ $OSTYPE == darwin* ]] ; then
    if [ -d "/Library/gurobi"* ] ; then
        grb_dirs=( /Library/gurobi* )
        nmb_dirs=${#grb_dirs[@]}

        GRB_INCLUDE_PATH="-I${grb_dirs[$nmb_dirs-1]}/mac64/include"
        GRB_LIB_PATH="-L${grb_dirs[$nmb_dirs-1]}/mac64/lib"
        GRB_LIBS="-lgurobi65"
        GRB_LIB_RPATH="-Wl,-rpath,${grb_dirs[$nmb_dirs-1]}/mac64/lib"
    else
        GRB_INCLUDE_PATH=
        GRB_LIB_PATH=
        GRB_LIBS=
        GRB_LIB_RPATH=
    fi

    TRAME_INCLUDE_PATH="$GRB_INCLUDE_PATH $NLOPT_INCLUDE_PATH"
    TRAME_LIB_PATH="$GRB_LIB_PATH $NLOPT_LIB_PATH"
    TRAME_LIBS="$GRB_LIBS $NLOPT_LIBS"
    TRAME_LIB_RPATH=$GRB_LIB_RPATH
elif [[ $OSTYPE == *linux* ]] ; then
    if [ -d "/opt/gurobi"* ] ; then
        grb_dirs=( /opt/gurobi* )
        nmb_dirs=${#grb_dirs[@]}

        GRB_INCLUDE_PATH="-I${grb_dirs[$nmb_dirs-1]}/linux64/include"
        GRB_LIB_PATH="-L${grb_dirs[$nmb_dirs-1]}/linux64/lib"
        GRB_LIBS="-lgurobi65"
        GRB_LIB_RPATH="-Wl,-rpath,${grb_dirs[$nmb_dirs-1]}/linux64/lib"
    else
        GRB_INCLUDE_PATH=
        GRB_LIB_PATH=
        GRB_LIBS=
        GRB_LIB_RPATH=
    fi

    TRAME_INCLUDE_PATH="$GRB_INCLUDE_PATH $NLOPT_INCLUDE_PATH"
    TRAME_LIB_PATH="$GRB_LIB_PATH $NLOPT_LIB_PATH"
    TRAME_LIBS="$GRB_LIBS $NLOPT_LIBS"
    TRAME_LIB_RPATH=$GRB_LIB_RPATH
else
    GRB_INCLUDE_PATH=
    GRB_LIB_PATH=
    GRB_LIBS=
    GRB_LIB_RPATH=

    TRAME_INCLUDE_PATH=
    TRAME_LIB_PATH=
    TRAME_LIBS=
    TRAME_LIB_RPATH=
fi

sed -e "s|@NLOPT_INCLUDE_PATH@|${NLOPT_INCLUDE_PATH}|" \
    -e "s|@NLOPT_LIB_PATH@|${NLOPT_LIB_PATH}|" \
    -e "s|@NLOPT_LIBS@|${NLOPT_LIBS}|" \
    -e "s|@GRB_INCLUDE_PATH@|${GRB_INCLUDE_PATH}|" \
    -e "s|@GRB_LIB_PATH@|${GRB_LIB_PATH}|" \
    -e "s|@GRB_LIBS@|${GRB_LIBS}|" \
    -e "s|@GRB_LIB_RPATH@|${GRB_LIB_RPATH}|" \
    -e "s|@TRAME_INCLUDE_PATH@|${TRAME_INCLUDE_PATH}|" \
    -e "s|@TRAME_LIB_PATH@|${TRAME_LIB_PATH}|" \
    -e "s|@TRAME_LIBS@|${TRAME_LIBS}|" \
    -e "s|@TRAME_LIB_RPATH@|${TRAME_LIB_RPATH}|" \
    src/Makevars.in > src/Makevars
